<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>EXPLAIN</title>
        <link href="r/libs/font-awesome/4.0.3/css/font-awesome.min.css" media="screen" rel="stylesheet" type="text/css">
        
        <link href="r/css/common.css" rel="stylesheet" />
        <link href="r/css/header.css" rel="stylesheet" />
        <link href="r/css/footer.css" rel="stylesheet" />
        <link href="r/css/mobile.css" rel="stylesheet" />
        <link href="r/css/manual.css" rel="stylesheet" />

        <link rel="stylesheet" href="https://www.infuq.com/resources/element-ui@2.15.2/index.css"/>
        <link rel="stylesheet" href="https://www.infuq.com/r/libs/font-awesome/4.0.3/css/font-awesome.min.css" media="screen" type="text/css" />
        <link rel="stylesheet" href="https://g.alicdn.com/de/prismplayer/2.8.2/skins/default/aliplayer-min.css"/>

        <style>
          .el-table .cell {                    
            text-align: left;
            white-space: pre-line;/*保留换行符*/
          }
        </style>

    </head>
<body>

    <!-- 中间 -->
    <section class="content-link" id="app">

      <!-- 
https://element.eleme.cn/#/zh-CN/component/collapse

      -->
        <div id="app">
            <span class="link">EXPLAIN</span>

            <div class="link-list">
                <p style="height: 10px;"></p>
                
                <el-collapse v-model="v2Names" >    
                  <el-collapse-item name="1">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ id ]</span>
                    </template>
                    <div>
                      
                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="2">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ select_type ]</span>
                    </template>
                    <div>
                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="3">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ table ]</span>
                    </template>
                    <div>
                      <template>    
                        <el-table
                          :data="tableData"
                          height="250"
                          stripe
                          style="width: 100%">
                          <el-table-column
                              prop="k1"
                              label="值"
                              width="180">
                          </el-table-column>
                          <el-table-column
                              prop="k2"
                              label="描述">
                          </el-table-column>
                        </el-table>
                      </template>


                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="4">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ possible_keys ]</span>
                    </template>
                    <div>
                      可能用到的索引<br>
                      注意 : 系统估计可能用到多个索引, 但最终只能用一个.
                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="5">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ key ] *</span>
                    </template>
                    <div>
                      真正使用的索引
                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="6">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ key_len ]</span>
                    </template>
                    <div>
                      使用的索引最大长度
                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="7">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ type ] *</span>
                    </template>
                    <div>
                      连接类型<br><br>
                      由快到慢 : system > const > eq_ref > ref > range > index > ALL<br><br>

                      <template>    
                        <el-table
                          :data="typeData"
                          stripe
                          style="width: 100%">
                          <el-table-column
                              prop="k1"
                              label="值"
                              width="180">
                          </el-table-column>
                          <el-table-column
                              prop="k2"
                              label="描述">
                          </el-table-column>
                        </el-table>
                      </template>

                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="8">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ ref ]</span>
                    </template>
                    <div>
                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="9">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ rows ] *</span>
                    </template>
                    <div>
                      估计扫描行数
                    </div>
                  </el-collapse-item>
                  <el-collapse-item name="10">
                    <template slot="title">
                      <!-- <i class="el-icon-magic-stick"></i> -->
                      <span style="color:crimson">[ extra ] *</span>
                    </template>
                    <div>
                      <template>    
                        <el-table
                          :data="extraData"
                          stripe
                          style="width: 100%">
                          <el-table-column
                              prop="k1"
                              label="值"
                              width="220">
                          </el-table-column>
                          <el-table-column
                              prop="k2"
                              label="描述">
                          </el-table-column>
                        </el-table>
                      </template>
                    </div>
                  </el-collapse-item>
                </el-collapse>
            </div>

<br>
<br>
<br>

            <span class="link">EXPLAIN Join Types</span>
            <br>
            <br>
            <span style="color: #e6a23c;">MySQL version : 5.7.37-log</span>
            <br>
            <br>
            <el-divider content-position="left">system</el-divider>
            <br>
            查看MySQL官方对system的<a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html#jointype_system" style="background-color:white;" target="_blank">说明</a>
            
            <br>
            <br>
            <i class="fa fa-tags" aria-hidden="true"></i> 案例一
            <br><br>
            首先创建两张表<br><br>
            <div class="block">
              <el-image 
                style="width: 50%; height: 50%"
                :src="creata_table_src" 
                :preview-src-list="creata_table_srcList">
              </el-image>
            </div>
            <br>
            除了表名称不同之外, 它们所使用的执行引擎也不同 .<br><br>
            接下来分别向两张表中各插入一条数据
            <br>
            <br>
            <div class="block">
              <el-image 
                style="width: 50%; height: 50%"
                :src="insert_table_src" 
                :preview-src-list="insert_table_srcList">
              </el-image>
            </div>
            <br>
            查看执行计划
            <br>
            <br>
            <div class="block">
              <el-image 
                style="width: 50%; height: 50%"
                :src="explain_table_src" 
                :preview-src-list="explain_table_srcList">
              </el-image>
            </div>
            <br>
            再向表中各插入一条数据, 每个表中各有2条数据 .
            <br>
            <br>
            <div class="block">
              <el-image 
                style="width: 50%; height: 50%"
                :src="again_insert_table_src" 
                :preview-src-list="again_insert_table_srcList">
              </el-image>
            </div>
            <br>
            再次查看执行计划
            <br>
            <br>
            <div class="block">
              <el-image 
                style="width: 50%; height: 50%"
                :src="again_explain_table_src" 
                :preview-src-list="again_explain_table_srcList">
              </el-image>
            </div>
            <br>
            <br>
            
            <span style="color: #67c23a;">结论</span>
            <br>
            MyISAM引擎的表, 表中只有一条数据, 进行简单查询时, 则type = system <br>
            <br>
            <br>
            <i class="fa fa-tags" aria-hidden="true"></i> 案例二
            <br><br>
            紧接着上面的实验, 使用子查询
            <br>
            <br>
            <div class="block">
              <el-image 
                style="width: 50%; height: 50%"
                :src="sub_query_explain_table_src" 
                :preview-src-list="sub_query_explain_table_srcList">
              </el-image>
            </div>
            <br>

            内层子查询返回一张临时表(仅包含一条数据), 外层从临时表查询, 其type = system <br>    
            <br><br>
            我们再次向表中各插入一条数据, 每张表各3条记录
            <br><br>
            <div class="block">
              <el-image 
                style="width: 50%; height: 50%"
                :src="three_record_table_src" 
                :preview-src-list="three_record_table_srcList">
              </el-image>
            </div>
            <br>
            如果子查询返回多条数据呢? 查看执行计划<br><br>
            <div class="block">
              <el-image 
                style="width: 50%; height: 50%"
                :src="three_record_explain_table_src" 
                :preview-src-list="three_record_explain_table_srcList">
              </el-image>
            </div>
            <br>





            <br>
            <span style="color: #67c23a;">结论</span>
            <br>
            子查询仅返回一条数据时, 则外层查询的type = system <br>
            





<br>
<br>
<br>


                <p style="height: 100px;"></p>
                人生除了眼前的苟且, 还有C++和远方.<br>
                深耕 & 浅尝辄止<br>




        </div>
    </section>

    <!-- 尾部 -->
    <script language="javascript" type="text/javascript" src="r/js/footer.js"></script>
	<script charset="utf-8" type="text/javascript" src="https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-min.js"></script>
    <script src="https://www.infuq.com/resources/vue@2.6.14/vue.js"></script>
    <script src="https://www.infuq.com/resources/element-ui@2.15.2/index.js"></script>
    <script src="https://www.infuq.com/resources/axios@0.21.1/axios.min.js"></script>
    <script type="text/javascript">
        const { defineComponent } = Vue
        const { h } = Vue;
        const Main = {
            data() {
                return {
                  // v2Names: ['5','7','9','10'],
                  v2Names: [],
                  creata_table_src: 'https://infuq.github.io/r/img/2022-2-26-1.png',
                  creata_table_srcList: [
                  'https://infuq.github.io/r/img/2022-2-26-1.png',
                  ],
                  insert_table_src: 'https://infuq.github.io/r/img/2022-2-26-2.png',
                  insert_table_srcList: [
                  'https://infuq.github.io/r/img/2022-2-26-2.png',
                  ],
                  explain_table_src: 'https://infuq.github.io/r/img/2022-2-26-3.png',
                  explain_table_srcList: [
                  'https://infuq.github.io/r/img/2022-2-26-3.png',
                  ],
                  again_insert_table_src: 'https://infuq.github.io/r/img/2022-2-26-4.png',
                  again_insert_table_srcList: [
                  'https://infuq.github.io/r/img/2022-2-26-4.png',
                  ],
                  again_explain_table_src: 'https://infuq.github.io/r/img/2022-2-26-5.png',
                  again_explain_table_srcList: [
                  'https://infuq.github.io/r/img/2022-2-26-5.png',
                  ],
                  sub_query_explain_table_src: 'https://infuq.github.io/r/img/2022-2-27-1.png',
                  sub_query_explain_table_srcList: [
                  'https://infuq.github.io/r/img/2022-2-27-1.png',
                  ],
                  three_record_table_src: 'https://infuq.github.io/r/img/2022-2-27-2.png',
                  three_record_table_srcList: [
                  'https://infuq.github.io/r/img/2022-2-27-2.png',
                  ],
                  three_record_explain_table_src: 'https://infuq.github.io/r/img/2022-2-27-3.png',
                  three_record_explain_table_srcList: [
                  'https://infuq.github.io/r/img/2022-2-27-3.png',
                  ],


                  

                  tableData: [{
                        k1: '实际表名',
                        k2: '如SELECT * FROM company'
                        }, {                    
                            k1: '表别名',
                            k2: '如SELECT * FROM company as cpy'
                        }, {                    
                            k1: 'derived',
                            k2: '如FROM子查询'
                        }, {                    
                            k1: 'NULL',
                            k2: '如直接计算得出结果 . EXPLAIN SELECT 1+2 \G;'                                        
                    }],

                    typeData: [{
                        k1: 'ALL',
                        k2: '全表扫描'
                        }, {                    
                            k1: 'index',
                            k2: '扫描所有索引节点'
                        }, {                    
                            k1: 'range',
                            k2: '根据索引进行范围扫描'
                        }, {                    
                            k1: 'index_subquery',
                            k2: ''          
                        }, {                    
                            k1: 'unique_subquery',
                            k2: ''
                        }, {                    
                            k1: 'index_merge',
                            k2: ''
                        }, {                    
                            k1: 'ref_or_null',
                            k2: ''              
                        }, {                    
                            k1: 'fulltext',
                            k2: ''          
                        }, {                    
                            k1: 'ref',
                            k2: '- 通过索引列直接引用匹配的所有行' + '\n' + 
                                  '- 非主键和非唯一索引扫描, 返回匹配的所有行'
                        }, {                    
                            k1: 'eq_ref',
                            k2: '- 通过索引列直接引用匹配的唯一一行' + '\n' + 
                                  '- 主键或非空唯一索引扫描, 对于每个索引键, 表中只有一条记录与之等值匹配'
                        }, {                    
                            k1: 'const',
                            k2: '常量连接'                                        
                        }, {                    
                            k1: 'system',
                            k2: '系统表, 或少量数据的表. 一般不需要进行磁盘IO'                                        
                    }],

                    extraData: [{
                        k1: 'using index',
                        k2: '表示相应的SELECT操作中使用了覆盖索引'
                        }, {                    
                            k1: 'using where',
                            k2: ''
                        }, {                    
                            k1: 'using where using index',
                            k2: ''
                        },{                    
                            k1: 'using index condition',
                            k2: ''
                        },{                    
                            k1: 'using temporary',
                            k2: 'MySQL需要使用临时表来存储结果集,常用于排序和分组查询'
                        }, {                    
                            k1: 'using filesort',
                            k2: 'MySQL无法使用索引完成的排序操作称为\'文件排序\''            
                        }, {                    
                            k1: 'range checked for each recond',
                            k2: ''                                        
                    }]

                }
            },
            created() {

            },

            methods: {

            }
        };

        var Ctor = Vue.extend(Main)
        new Ctor().$mount('#app')
    </script>
</body>
</html>
